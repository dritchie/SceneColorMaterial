\section{Approach}
\label{sec:approach}

%\remark{D: Tom Funkhouser sold me on the value of this section, and one of the best examples from his papers is in http://www.cs.princeton.edu/~funk/pvg01.pdf. I actually like combining the Approach and Overview sections into one shorter section, though.}

%Restate the goal/problem. Use Sharon's more descriptive definition of a pattern template.
The goal of this paper is to develop a method for automatically generating pattern coloring suggestions to facilitate the creative coloring process. One challenge of such a system is that users may or may not have a target coloring style in mind. In addition, aesthetic taste varies across users and can depend on the situation. Thus, an effective color support system should both output a wide variety of appealing colorings, as well as provide controls to let the user personalize suggestions to their preferred coloring style.

%Although many people can easily judge whether a pattern coloring is appealing to them, creating an appealing coloring can take much more time and effort. The process often involves much trial-and-error as well as tweaking of colors, due to constraints between neighboring regions. Since the relationship between neighboring colors largely impacts color appearance, changing one color also often results in cascading changes to neighboring colors.

%Start of notes on pattern template terminology/definition.
Our approach takes as input a pattern template and any user-provided guidelines if available, and outputs suggested colorings for that pattern template. A pattern template specifies which regions in an image can be colored in, and which regions must map to the same color. For example, an image of a flower on a background may have a template that specifies all petals of the flower must be the same color, and all background regions must be the same color. In the rest of the paper, we refer to the set of regions that map to the same color as a \emph{color group}. Figure~\ref{fig:teaser} shows an example of a pattern template visualized in grayscale, where each lightness level identifies a different color group. This pattern template representation is relatively easy to author from images composed of segments, such as web designs, renderings of 3D scenes, and line drawings. In this paper, we focus on 2D graphic design patterns. 

To generate attractive pattern colorings, a reasonable first step is to enforce that the colors used are `compatible' with one another, for some definition of color compatibility. Figure~\ref{fig:ColorCompatOnly} shows several patterns whose colors receive a high score under the color compatibility model of O'Donovan et al.~\shortcite{ODonovan}. While high-scoring colorings do exhibit a great degree of diversity, scoring a coloring based soley on the compatibility of its colors is not enough as pattern appearance also relies on relative proportion and spatial arrangement of colors. The colorings in the figure exhibit several problems due to arrangement, such as foreground regions that blend into the background, and background regions that are too `loud' in color. Furthermore, color compatibility is a universal notion: it is not clear how to adapt it to match the style of a particular artist or the preferences of a particular user.

%Large, background regions are colored differently than smaller, scattered `accent' regions; a thin, ribbon-like region against an empty field is colored differently than a thin region amidst a mass of similar regions.

%While compatible colors are an important component of attractive pattern colorings, they do not tell the whole story. The notion of color compatibility, whether implemented via the O'Donovan model or any other, considers colors abstractly: it does not take into account how they will be spatially used in the pattern. 

\begin{figure}[htb]
\centering
%\includegraphics[width=\columnwidth]{figs/colorCompatOnly.png}
\begin{tabular}{cccc}
\includegraphics[width=.2\columnwidth]{figs/colorCompat/r_0_0_3-75}&
\includegraphics[width=.2\columnwidth]{figs/colorCompat/r_0_1_3-32}&
\includegraphics[width=.2\columnwidth]{figs/colorCompat/r_0_2_3-67}&
\includegraphics[width=.2\columnwidth]{figs/colorCompat/r_0_3_3-70}\\
3.75&3.32&3.67&3.70\vspace{0.5em}\\
\includegraphics[width=.2\columnwidth]{figs/colorCompat/r_1_0_3-74}&
\includegraphics[width=.2\columnwidth]{figs/colorCompat/r_1_1_3-42}&
\includegraphics[width=.2\columnwidth]{figs/colorCompat/r_1_2_3-66}&
\includegraphics[width=.2\columnwidth]{figs/colorCompat/r_1_3_3-39}\\
3.74&3.42&3.66&3.39\\
\end{tabular}
\caption{Patterns whose colors receive high scores under the color compatibility model of O'Donovan et al.~\shortcite{ODonovan}. The score assigned by the O'Donovan model is shown beneath each pattern, with a typical pattern receiving a score between 3 and 4. Many results exhibit problems such as adjacent equi-luminant regions and excessively saturated backgrounds.}
\label{fig:ColorCompatOnly}
\end{figure}

Rather than develop a specialized algorithm for this problem, we exploit the insight that both of these concerns---color harmony and spatial consistency---can be encoded in the extremely general framework of probabilistic factor graphs. In the next sections, we develop a data-driven factor graph model that can be trained on example colored patterns and sampled to generate new coloring suggestions. The factor graph formalism allows us to leverage existing models of color compatibility, to plug in additional coloring constraints in response to available user input, and to capture and inspect the characteristics of desired styles through established machine learning techniques.
